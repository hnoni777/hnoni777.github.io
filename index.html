<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ëŒ€í˜•íê¸°ë¬¼ ìœ„ì¹˜ê³µìœ </title>
    <link rel="manifest" href="manifest.json" />
    <style>
        body {
            margin: 0;
            background: #f1f1f1;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #introScreen {
            width: 100vw;
            height: 100vh;
            background: url('intro.png') center/cover no-repeat;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 80px;
        }

        #startButton {
            padding: 15px 28px;
            background: #ffffffdd;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            box-shadow: 0px 2px 6px rgba(0,0,0,0.25);
        }

        #app {
            display: none;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #map {
            height: 60vh;
            background: #ddd;
        }

        #infoBox {
            padding: 10px;
            background: #fff;
        }

        #photoBox {
            height: 40vh;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #photoPreview {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }

        .btnLine {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        button {
            padding: 10px 18px;
            background: #2c64ff;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 15px;
        }

        #cameraInput {
            display: none;
        }
    </style>

    <!-- ì¹´ì¹´ì˜¤ë§µ -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c473f288616318b4fa69c041aaaed4c3&libraries=services"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
</head>

<body>

    <!-- ì¸íŠ¸ë¡œ í™”ë©´ -->
    <div id="introScreen">
        <button id="startButton">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜</button>
    </div>

    <!-- ì‹¤ì œ ì•± í™”ë©´ -->
    <div id="app">
        <div id="map"></div>

        <div id="infoBox">
            <div>ë„ë¡œëª…: <span id="roadAddress">-</span></div>
            <div>ì§€ë²ˆ: <span id="jibunAddress">-</span></div>

            <div class="btnLine">
                <button onclick="copyAddress()">ì£¼ì†Œ ë³µì‚¬</button>
                <label for="cameraInput">
                    <button>ì‚¬ì§„ ì´¬ì˜</button>
                </label>
            </div>
        </div>

        <div id="photoBox">
            <img id="photoPreview" />
        </div>
    </div>

    <input id="cameraInput" type="file" accept="image/*" capture="environment">

<script>
    const intro = document.getElementById("introScreen");
    const app = document.getElementById("app");
    const startBtn = document.getElementById("startButton");

    startBtn.onclick = () => {
        intro.style.display = "none";
        app.style.display = "flex";
        document.getElementById("cameraInput").click();
    };

    let map, geocoder, marker;

    function initMap(lat, lng) {
        const container = document.getElementById("map");
        const options = { center: new kakao.maps.LatLng(lat, lng), level: 3 };
        map = new kakao.maps.Map(container, options);

        marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(lat, lng) });
        marker.setMap(map);

        geocoder = new kakao.maps.services.Geocoder();
        getAddress(lat, lng);
    }

    function getAddress(lat, lng) {
        geocoder.coord2Address(lng, lat, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                const road = result[0].road_address ? result[0].road_address.address_name : "-";
                const jibun = result[0].address.address_name;

                document.getElementById("roadAddress").innerText = road;
                document.getElementById("jibunAddress").innerText = jibun;
            }
        });
    }

    document.getElementById("cameraInput").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById("photoPreview").src = e.target.result;
        };
        reader.readAsDataURL(file);

        EXIF.getData(file, function() {
            let lat = EXIF.getTag(this, "GPSLatitude");
            let lng = EXIF.getTag(this, "GPSLongitude");
            let latRef = EXIF.getTag(this, "GPSLatitudeRef");
            let lngRef = EXIF.getTag(this, "GPSLongitudeRef");

            if (!lat || !lng) {
                alert("ì‚¬ì§„ì— GPS ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            lat = convertDMSToDD(lat[0], lat[1], lat[2], latRef);
            lng = convertDMSToDD(lng[0], lng[1], lng[2], lngRef);

            initMap(lat, lng);
        });
    });

    function convertDMSToDD(deg, min, sec, ref) {
        let dd = deg + min/60 + sec/(3600*1000);
        if (ref === "S" || ref === "W") dd = dd * -1;
        return dd;
    }

    function copyAddress() {
        const text =
            `ë„ë¡œëª…: ${document.getElementById("roadAddress").innerText}\nì§€ë²ˆ: ${document.getElementById("jibunAddress").innerText}`;
        navigator.clipboard.writeText(text);
        alert("ì£¼ì†Œ ë³µì‚¬ ì™„ë£Œ!");
    }
</script>

</body>
</html>
