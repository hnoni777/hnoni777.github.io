<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€í˜•íê¸°ë¬¼ ìœ„ì¹˜ê³µìœ </title>

    <style>
        body, html {
            margin:0;
            padding:0;
            width:100%;
            height:100%;
            font-family: Arial, sans-serif;
            overflow:hidden;
            background:#fff;
        }

        /* ğŸ”¥ ì¸íŠ¸ë¡œ í™”ë©´ ì „ì²´ ì´ë¯¸ì§€ */
        #introScreen {
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:url('intro.jpg') no-repeat center center;
            background-size:cover;
            z-index:9999;
            display:flex;
            align-items:center;
            justify-content:center;
        }

        /* ğŸ”¥ ì¸íŠ¸ë¡œ ì‚¬ì§„ì´¬ì˜ ë²„íŠ¼ (ë°˜ì‘í˜• ìˆ˜ì • ì™„ë£Œ) */
        #introStartBtn {
            position:absolute;
            left:50%;
            transform:translateX(-50%);

            /* ì´ë¯¸ì§€ ë¹„ìœ¨ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ìœ„ì¹˜ë˜ê²Œ */
            bottom:12%;

            width:55%;
            height:9%;

            background:rgba(0,0,0,0);
            border:none;
            cursor:pointer;
        }

        /* ë©”ì¸ UI */
        #mainContainer {
            width:100%;
            height:100%;
            display:none;
            flex-direction:column;
        }

        /* ì§€ë„ ì˜ì—­ */
        #map {
            width:100%;
            height:60%;
        }

        /* ì£¼ì†Œ + ë²„íŠ¼ ë¼ì¸ */
        #infoArea {
            width:100%;
            height:10%;
            padding:10px;
            box-sizing:border-box;
            font-size:14px;
        }

        /* ì‚¬ì§„ ì˜ì—­ */
        #photoArea {
            width:100%;
            height:30%;
            display:flex;
            align-items:center;
            justify-content:center;
            background:#f5f5f5;
        }

        #photoPreview {
            max-width:95%;
            max-height:95%;
            border-radius:10px;
            display:none;
        }

        /* ë²„íŠ¼ ê³µí†µ */
        .btn {
            padding:8px 14px;
            border:none;
            border-radius:8px;
            background:#3f51b5;
            color:white;
            font-size:13px;
            margin-right:8px;
        }

        #fileInput {
            display:none;
        }

    </style>

    <!-- Leaflet ì§€ë„ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- EXIF -->
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

</head>
<body>

    <!-- ğŸ”¥ ì¸íŠ¸ë¡œ í™”ë©´ -->
    <div id="introScreen">
        <button id="introStartBtn"></button>
    </div>

    <!-- ğŸ”¥ ë©”ì¸ í™”ë©´ -->
    <div id="mainContainer">

        <!-- ì§€ë„ -->
        <div id="map"></div>

        <!-- ì£¼ì†Œ í‘œì‹œ + ë²„íŠ¼ -->
        <div id="infoArea">
            <div>ë„ë¡œëª…: <span id="roadAddr">-</span></div>
            <div>ì§€ë²ˆ: <span id="jibunAddr">-</span></div>

            <button class="btn" id="copyAddressBtn">ì£¼ì†Œ ë³µì‚¬</button>
            <button class="btn" id="takePhotoBtn">ì‚¬ì§„ ì´¬ì˜</button>
            <button class="btn" id="saveImageBtn">ì‚¬ì§„ ì €ì¥</button>

            <input type="file" id="fileInput" accept="image/*" capture="environment">
        </div>

        <!-- ì‚¬ì§„ ì¶œë ¥ -->
        <div id="photoArea">
            <img id="photoPreview">
        </div>

    </div>

<script>
//////////////////////
// ğŸ”¥ ì¸íŠ¸ë¡œ â†’ ë©”ì¸ í™”ë©´ ì „í™˜
//////////////////////
document.getElementById("introStartBtn").addEventListener("click", () => {
    document.getElementById("introScreen").style.display = "none";
    document.getElementById("mainContainer").style.display = "flex";
});


//////////////////////
// ì§€ë„ ì´ˆê¸°í™”
//////////////////////
let map = L.map('map').setView([37.5665, 126.9780], 17);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
}).addTo(map);

let marker = null;


//////////////////////
// ì£¼ì†Œ ë³€í™˜ í•¨ìˆ˜ (ì¹´ì¹´ì˜¤ API)
//////////////////////
async function convertToAddress(lat, lng) {
    const REST_API_KEY = "ì—¬ê¸°ì—_ë„ˆì˜_ì¹´ì¹´ì˜¤_REST_API_KEY_ì…ë ¥";

    let url = `https://dapi.kakao.com/v2/local/geo/coord2address.json?x=${lng}&y=${lat}`;
    let response = await fetch(url, {
        headers: { Authorization: `KakaoAK ${REST_API_KEY}` }
    });

    let json = await response.json();
    if (json.documents.length > 0) {
        let addr = json.documents[0].address.address_name;
        let road = json.documents[0].road_address 
            ? json.documents[0].road_address.address_name 
            : "-";

        document.getElementById("roadAddr").innerText = road;
        document.getElementById("jibunAddr").innerText = addr;
    }
}


//////////////////////
// ì‚¬ì§„ ì´¬ì˜ ë²„íŠ¼
//////////////////////
document.getElementById("takePhotoBtn").addEventListener("click", () => {
    document.getElementById("fileInput").click();
});

document.getElementById("fileInput").addEventListener("change", async function(){
    let file = this.files[0];
    if (!file) return;

    let img = document.getElementById("photoPreview");
    img.src = URL.createObjectURL(file);
    img.style.display = "block";

    EXIF.getData(file, function(){
        let lat = EXIF.getTag(this, "GPSLatitude");
        let lng = EXIF.getTag(this, "GPSLongitude");
        let latRef = EXIF.getTag(this, "GPSLatitudeRef");
        let lngRef = EXIF.getTag(this, "GPSLongitudeRef");

        if(lat && lng){
            function toDecimal(num){
                return num[0] + num[1]/60 + num[2]/3600;
            }
            let latitude = toDecimal(lat);
            let longitude = toDecimal(lng);

            if(latRef === "S") latitude *= -1;
            if(lngRef === "W") longitude *= -1;

            if(marker) map.removeLayer(marker);

            marker = L.marker([latitude, longitude]).addTo(map);
            map.setView([latitude, longitude], 18);

            convertToAddress(latitude, longitude);
        }
    });
});


//////////////////////
// ì£¼ì†Œ ë³µì‚¬
//////////////////////
document.getElementById("copyAddressBtn").addEventListener("click", () => {
    let full = 
        "ë„ë¡œëª…: " + document.getElementById("roadAddr").innerText +
        " / ì§€ë²ˆ: " + document.getElementById("jibunAddr").innerText;

    navigator.clipboard.writeText(full);
    alert("ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
});


//////////////////////
// ì‚¬ì§„ ì €ì¥ (ê°¤ëŸ¬ë¦¬ ì €ì¥)
//////////////////////
document.getElementById("saveImageBtn").addEventListener("click", () => {
    let img = document.getElementById("photoPreview");
    if (!img.src) return alert("ì €ì¥í•  ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤!");

    let link = document.createElement("a");
    link.href = img.src;
    link.download = "photo.jpg";
    link.click();
});
</script>

</body>
</html>
