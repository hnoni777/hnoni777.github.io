<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëŒ€í˜•íê¸°ë¬¼ ìœ„ì¹˜ê³µìœ </title>

<!-- ğŸ”¥ ì¹´ì¹´ì˜¤ë§µ SDK (ì •í™•í•œ JavaScript í‚¤ í¬í•¨) -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c473f288661318b4fa69c041aaaed4c3&libraries=services"></script>

<!-- EXIF GPS ì¡°íšŒ -->
<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans KR',sans-serif;}
    html,body{width:100%;height:100%;overflow:hidden;}

    /* ğŸ”¥ ì¸íŠ¸ë¡œ í™”ë©´ */
    #intro{
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        background:url("intro.png") center/cover no-repeat;
        display:flex; justify-content:center; align-items:flex-end;
        padding-bottom:12%;
    }
    #startBtn{
        width:75%;
        padding:18px;
        background:#ffffffdd;
        border-radius:40px;
        text-align:center;
        font-size:20px;
        font-weight:700;
        color:#333;
        box-shadow:0 4px 10px rgba(0,0,0,0.2);
    }

    /* ğŸ”¥ ë©”ì¸ */
    #main{
        display:none;
        width:100%; height:100%;
        display:flex; flex-direction:column;
    }

    #topArea{
        flex:1;
        padding:10px;
        display:flex; flex-direction:column;
        gap:10px;
    }
    #map{
        width:100%;
        flex:1;
        border-radius:10px;
        background:#ddd;
    }
    #addressBox{
        background:white;
        padding:12px;
        border-radius:10px;
        font-size:16px;
        line-height:1.5;
        box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }

    #buttons{ display:flex; gap:8px; }
    .btn{
        flex:1;
        padding:12px;
        text-align:center;
        background:#2d7bff;
        color:white;
        font-size:16px;
        font-weight:600;
        border-radius:10px;
    }

    #bottomArea{
        flex:1; padding:10px;
    }
    #preview{
        width:100%; height:100%;
        object-fit:cover;
        border-radius:10px;
        background:#ccc;
    }

    input[type=file]{display:none;}
</style>
</head>

<body>

<!-- ğŸ”¥ ì¸íŠ¸ë¡œ -->
<div id="intro">
    <div id="startBtn">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜ ì‹œì‘í•˜ê¸°</div>
</div>

<!-- ğŸ”¥ ë©”ì¸ -->
<div id="main">

    <div id="topArea">
        <div id="map"></div>

        <div id="addressBox">
            ë„ë¡œëª…: <span id="road">-</span><br>
            ì§€ë²ˆ: <span id="jibun">-</span>
        </div>

        <div id="buttons">
            <div class="btn" id="copyBtn">ì£¼ì†Œë³µì‚¬</div>
            <div class="btn" id="retakeBtn">ë‹¤ì‹œì´¬ì˜</div>
            <div class="btn" id="openBtn">ì‚¬ì§„ì—´ê¸°</div>
        </div>
    </div>

    <div id="bottomArea">
        <img id="preview">
    </div>
</div>

<input type="file" id="cameraInput" accept="image/*;capture=camera">
<input type="file" id="openInput" accept="image/*">

<script>

let map, geocoder;

/* ğŸ”¥ ì¸íŠ¸ë¡œ ë²„íŠ¼ í´ë¦­ â†’ ì¹´ë©”ë¼ ì‹¤í–‰ */
document.getElementById("startBtn").onclick = () => {
    document.getElementById("intro").style.display="none";
    document.getElementById("main").style.display="flex";
    openCamera();
};

/* ğŸ”¥ ì¹´ë©”ë¼ ì‹¤í–‰ */
function openCamera(){
    const cam = document.getElementById("cameraInput");
    cam.value="";
    cam.click();

    cam.onchange = ()=>{
        const file = cam.files[0];
        if(!file) return;
        showPhoto(file);
        extractGPS(file);
    }
}

/* ğŸ”¥ ì‚¬ì§„ ì—´ê¸° */
document.getElementById("openBtn").onclick = ()=>{
    const op = document.getElementById("openInput");
    op.value="";
    op.click();

    op.onchange = ()=>{
        const file = op.files[0];
        if(!file) return;
        showPhoto(file);
        extractGPS(file);
    }
};

/* ğŸ”¥ ë¯¸ë¦¬ë³´ê¸° */
function showPhoto(file){
    document.getElementById("preview").src = URL.createObjectURL(file);
}

/* ğŸ”¥ EXIF GPS ì¶”ì¶œ */
function extractGPS(file){
    EXIF.getData(file, function(){
        const lat = EXIF.getTag(this,"GPSLatitude");
        const lon = EXIF.getTag(this,"GPSLongitude");
        const latRef = EXIF.getTag(this,"GPSLatitudeRef");
        const lonRef = EXIF.getTag(this,"GPSLongitudeRef");

        if(!lat || !lon){
            alert("ì‚¬ì§„ì— ìœ„ì¹˜ì •ë³´ ì—†ìŒ â†’ ì„œìš¸ì‹œì²­ ê¸°ë³¸ê°’");
            loadMap(37.5665,126.9780);
            searchAddress(37.5665,126.9780);
            return;
        }

        const latitude = toDeg(lat,latRef);
        const longitude = toDeg(lon,lonRef);

        loadMap(latitude,longitude);
        searchAddress(latitude,longitude);
    });
}

function toDeg(v,r){
    const d=v[0], m=v[1], s=v[2];
    let res=d + m/60 + s/3600;
    if(r==="S"||r==="W") res*=-1;
    return res;
}

/* ğŸ”¥ ì§€ë„ ë¡œë“œ */
function loadMap(lat,lon){
    const container=document.getElementById("map");
    map=new kakao.maps.Map(container,{
        center:new kakao.maps.LatLng(lat,lon),
        level:3
    });

    geocoder=new kakao.maps.services.Geocoder();

    new kakao.maps.Marker({
        map:map,
        position:new kakao.maps.LatLng(lat,lon)
    });
}

/* ğŸ”¥ ì£¼ì†Œ ë³€í™˜ */
function searchAddress(lat,lon){
    geocoder.coord2Address(lon,lat,(result,status)=>{
        if(status===kakao.maps.services.Status.OK){
            const road = result[0].road_address
                ? result[0].road_address.address_name
                : "-";
            const jibun = result[0].address.address_name;

            document.getElementById("road").innerText = road;
            document.getElementById("jibun").innerText = jibun;
        }
    });
}

/* ğŸ”¥ ì£¼ì†Œ ë³µì‚¬ */
document.getElementById("copyBtn").onclick = ()=>{
    const text=`ë„ë¡œëª…: ${document.getElementById("road").innerText}
ì§€ë²ˆ: ${document.getElementById("jibun").innerText}`;
    navigator.clipboard.writeText(text);
    alert("ì£¼ì†Œ ë³µì‚¬ë¨!");
};

/* ğŸ”¥ ë‹¤ì‹œ ì´¬ì˜ */
document.getElementById("retakeBtn").onclick = ()=> openCamera();

</script>
</body>
</html>
