<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëŒ€í˜•íê¸°ë¬¼ ìœ„ì¹˜ê³µìœ </title>

<!-- ğŸ”¥ ì¹´ì¹´ì˜¤ë§µ SDK â€” ë„¤ê°€ ì¤€ ì •í™•í•œ JavaScript í‚¤ í¬í•¨ -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c473f288661318b4fa69c041aaaed4c3&libraries=services"></script>

<!-- EXIFë¡œ ì‚¬ì§„ GPS ì½ê¸° -->
<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans KR',sans-serif;}
    html,body{width:100%;height:100%;overflow:hidden;background:#f3f3f3;}

    /* ì¸íŠ¸ë¡œ */
    #intro{
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        background:url("intro.png") center/cover no-repeat;
        display:flex; justify-content:center; align-items:flex-end;
        padding-bottom:13%;
    }
    #startBtn{
        width:72%;
        padding:18px;
        background:#ffffffdd;
        text-align:center;
        border-radius:40px;
        font-size:20px;
        font-weight:700;
        box-shadow:0 4px 10px rgba(0,0,0,0.25);
        color:#222;
    }

    /* ë©”ì¸ */
    #main{
        display:none;
        width:100%; height:100%;
        display:flex; flex-direction:column;
    }

    #top{
        flex:1;
        padding:10px;
        display:flex; flex-direction:column;
        gap:10px;
    }

    #map{
        width:100%;
        flex:1;
        border-radius:10px;
        background:#ddd;
    }

    #addrBox{
        background:#fff;
        padding:12px;
        border-radius:10px;
        font-size:16px;
        line-height:1.5;
        box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }

    #btnRow{
        display:flex;
        gap:8px;
    }
    .btn{
        flex:1;
        padding:12px;
        background:#2d7bff;
        color:white;
        text-align:center;
        font-size:15px;
        font-weight:700;
        border-radius:10px;
    }

    #bottom{
        flex:1;
        padding:10px;
    }
    #preview{
        width:100%; height:100%;
        object-fit:cover;
        border-radius:10px;
        background:#ccc;
    }

    input[type=file]{display:none;}
</style>
</head>

<body>

<!-- ì¸íŠ¸ë¡œ -->
<div id="intro">
    <div id="startBtn">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜ ì‹œì‘í•˜ê¸°</div>
</div>

<!-- ë©”ì¸ -->
<div id="main">

    <div id="top">
        <div id="map"></div>

        <div id="addrBox">
            ë„ë¡œëª…: <span id="road">-</span><br>
            ì§€ë²ˆ: <span id="jibun">-</span>
        </div>

        <div id="btnRow">
            <div class="btn" id="copyBtn">ì£¼ì†Œë³µì‚¬</div>
            <div class="btn" id="retakeBtn">ë‹¤ì‹œì´¬ì˜</div>
            <div class="btn" id="openBtn">ì‚¬ì§„ì—´ê¸°</div>
        </div>
    </div>

    <div id="bottom">
        <img id="preview">
    </div>

</div>

<input type="file" id="cameraInput" accept="image/*;capture=camera">
<input type="file" id="openInput" accept="image/*">

<script>
let map, geocoder;

/* ğŸ”¥ ì¸íŠ¸ë¡œ â†’ ì¹´ë©”ë¼ */
document.getElementById("startBtn").onclick = () => {
    document.getElementById("intro").style.display="none";
    document.getElementById("main").style.display="flex";
    openCamera();
};

/* ğŸ”¥ ì¹´ë©”ë¼ ì‹¤í–‰ */
function openCamera(){
    const cam = document.getElementById("cameraInput");
    cam.value="";
    cam.click();
    cam.onchange = ()=>{
        const file = cam.files[0];
        if(!file) return;
        showPhoto(file);
        extractGPS(file);
    };
}

/* ğŸ”¥ ì‚¬ì§„ ì—´ê¸° */
document.getElementById("openBtn").onclick=()=>{
    const op = document.getElementById("openInput");
    op.value="";
    op.click();
    op.onchange=()=>{
        const file = op.files[0];
        if(!file) return;
        showPhoto(file);
        extractGPS(file);
    };
};

/* ğŸ”¥ ë¯¸ë¦¬ë³´ê¸° */
function showPhoto(file){
    document.getElementById("preview").src = URL.createObjectURL(file);
}

/* ğŸ”¥ GPS ì¶”ì¶œ */
function extractGPS(file){
    EXIF.getData(file,function(){
        const lat = EXIF.getTag(this,"GPSLatitude");
        const lon = EXIF.getTag(this,"GPSLongitude");
        const latR= EXIF.getTag(this,"GPSLatitudeRef");
        const lonR= EXIF.getTag(this,"GPSLongitudeRef");

        if(!lat||!lon){
            alert("ì‚¬ì§„ì— GPS ì •ë³´ ì—†ìŒ â†’ ì„œìš¸ì‹œì²­ í‘œì‹œ");
            loadMap(37.5665,126.9780);
            searchAddr(37.5665,126.9780);
            return;
        }

        const latitude = toDeg(lat,latR);
        const longitude= toDeg(lon,lonR);

        loadMap(latitude,longitude);
        searchAddr(latitude,longitude);
    });
}

function toDeg(v,r){
    const d=v[0], m=v[1], s=v[2];
    let res=d+m/60+s/3600;
    if(r==="S"||r==="W") res*=-1;
    return res;
}

/* ğŸ”¥ ì§€ë„ */
function loadMap(lat,lon){
    const container=document.getElementById("map");
    map=new kakao.maps.Map(container,{
        center:new kakao.maps.LatLng(lat,lon),
        level:3
    });

    geocoder=new kakao.maps.services.Geocoder();
    new kakao.maps.Marker({
        map:map,
        position:new kakao.maps.LatLng(lat,lon)
    });
}

/* ğŸ”¥ ì£¼ì†Œ ë³€í™˜ */
function searchAddr(lat,lon){
    geocoder.coord2Address(lon,lat,(result,status)=>{
        if(status===kakao.maps.services.Status.OK){
            const road = result[0].road_address
                ? result[0].road_address.address_name : "-";
            const jibun = result[0].address.address_name;

            document.getElementById("road").innerText = road;
            document.getElementById("jibun").innerText = jibun;
        }
    });
}

/* ğŸ”¥ ë³µì‚¬ */
document.getElementById("copyBtn").onclick=()=>{
    const txt =
`ë„ë¡œëª…: ${document.getElementById("road").innerText}
ì§€ë²ˆ: ${document.getElementById("jibun").innerText}`;
    navigator.clipboard.writeText(txt);
    alert("ì£¼ì†Œ ë³µì‚¬ë¨!");
};

/* ğŸ”¥ ë‹¤ì‹œì´¬ì˜ */
document.getElementById("retakeBtn").onclick=()=>openCamera();

</script>

</body>
</html>
