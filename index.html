<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ëŒ€í˜•íê¸°ë¬¼ ìœ„ì¹˜ê³µìœ </title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; }

        body, html {
            width: 100%;
            height: 100%;
            background: #f3f3f3;
            overflow: hidden;
        }

        /* ğŸ“Œ ì¸íŠ¸ë¡œ í™”ë©´ */
        #introScreen {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: url("intro.png");
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 12%;
        }

        #startBtn {
            width: 75%;
            padding: 18px;
            background: #ffffffdd;
            border-radius: 40px;
            font-size: 20px;
            text-align: center;
            color: #333;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* ğŸ“Œ ë©”ì¸ í™”ë©´ ì»¨í…Œì´ë„ˆ */
        #mainScreen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
        }

        /* ìƒë‹¨ 50% (ì§€ë„ + ì£¼ì†Œ + ë²„íŠ¼3ê°œ) */
        #topArea {
            height: 50%;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #map {
            width: 100%;
            height: 55%;
            background: #ddd;
            border-radius: 10px;
        }

        #addressBox {
            background: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 15px;
            line-height: 1.5;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        #btnRow {
            display: flex;
            justify-content: space-between;
            gap: 6px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            background: #2c78ff;
            color: white;
            border-radius: 10px;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
        }

        /* í•˜ë‹¨ 50% (ì‚¬ì§„ í‘œì‹œ) */
        #bottomArea {
            height: 50%;
            padding: 10px;
        }

        #previewImg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            background: #ccc;
        }

        input[type="file"] {
            display: none;
        }
    </style>

    <!-- ì¹´ì¹´ì˜¤ë§µ JS í‚¤ -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c473f288661318b4fa69c041aaaed4c3&libraries=services"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
</head>

<body>

    <!-- ì¸íŠ¸ë¡œ í™”ë©´ -->
    <div id="introScreen">
        <div id="startBtn">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜ ì‹œì‘í•˜ê¸°</div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen">
        <div id="topArea">

            <div id="map"></div>

            <div id="addressBox">
                ë„ë¡œëª…: <span id="roadAddr">-</span><br>
                ì§€ë²ˆ: <span id="jibunAddr">-</span>
            </div>

            <div id="btnRow">
                <div class="btn" id="copyBtn">ì£¼ì†Œë³µì‚¬</div>
                <div class="btn" id="retakeBtn">ë‹¤ì‹œì´¬ì˜</div>
                <div class="btn" id="openBtn">ì‚¬ì§„ì—´ê¸°</div>
            </div>
        </div>

        <div id="bottomArea">
            <img id="previewImg" src="">
        </div>
    </div>

    <input type="file" accept="image/*" id="fileInput">

<script>
    let map, geocoder;

    /* ============================
       ğŸ“Œ ì¸íŠ¸ë¡œ â†’ ë©”ì¸ í™”ë©´ ì „í™˜ + ì¹´ë©”ë¼ ì‹¤í–‰
    ============================ */
    document.getElementById("startBtn").onclick = () => {
        document.getElementById("introScreen").style.display = "none";
        document.getElementById("mainScreen").style.display = "flex";
        openCamera();
    };

    /* ============================
       ğŸ“Œ ì¹´ë©”ë¼ ì´¬ì˜
    ============================ */
    function openCamera() {
        const fileInput = document.getElementById("fileInput");
        fileInput.accept = "image/*;capture=camera";
        fileInput.click();

        fileInput.onchange = () => {
            const file = fileInput.files[0];
            if (!file) return;

            const imgURL = URL.createObjectURL(file);
            document.getElementById("previewImg").src = imgURL;

            readImageGPS(file);
        };
    }

    /* ============================
       ğŸ“Œ ì‚¬ì§„ EXIFì—ì„œ GPS ì¢Œí‘œ ì½ê¸°
    ============================ */
    function readImageGPS(file) {
        EXIF.getData(file, function() {
            const lat = EXIF.getTag(this, "GPSLatitude");
            const lon = EXIF.getTag(this, "GPSLongitude");
            const latRef = EXIF.getTag(this, "GPSLatitudeRef");
            const lonRef = EXIF.getTag(this, "GPSLongitudeRef");

            if (!lat || !lon) {
                alert("ì‚¬ì§„ì— ìœ„ì¹˜ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
                resetMap(37.5665, 126.9780); // ì„œìš¸ ê¸°ë³¸
                return;
            }

            const latitude = convertGPS(lat, latRef);
            const longitude = convertGPS(lon, lonRef);

            resetMap(latitude, longitude);
            searchAddress(latitude, longitude);
        });
    }

    function convertGPS(gps, ref) {
        const d = gps[0], m = gps[1], s = gps[2];
        let v = d + m/60 + s/3600;
        if (ref === "S" || ref === "W") v = v * -1;
        return v;
    }

    /* ============================
       ğŸ“Œ ì§€ë„ ìƒì„± + ìœ„ì¹˜ ì´ë™
    ============================ */
    function resetMap(lat, lon) {
        const mapContainer = document.getElementById('map');

        const options = {
            center: new kakao.maps.LatLng(lat, lon),
            level: 3
        };

        map = new kakao.maps.Map(mapContainer, options);
        geocoder = new kakao.maps.services.Geocoder();

        let marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(lat, lon) });
        marker.setMap(map);
    }

    /* ============================
       ğŸ“Œ ì¢Œí‘œ â†’ ì£¼ì†Œ ë³€í™˜
    ============================ */
    function searchAddress(lat, lon) {
        geocoder.coord2Address(lon, lat, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                const road = result[0].road_address ? result[0].road_address.address_name : "-";
                const jibun = result[0].address.address_name;

                document.getElementById("roadAddr").textContent = road;
                document.getElementById("jibunAddr").textContent = jibun;
            }
        });
    }

    /* ============================
       ğŸ“Œ ë²„íŠ¼ ê¸°ëŠ¥ë“¤
    ============================ */
    document.getElementById("copyBtn").onclick = () => {
        const text = 
            "ë„ë¡œëª…: " + document.getElementById("roadAddr").innerText +
            "\nì§€ë²ˆ: " + document.getElementById("jibunAddr").innerText;

        navigator.clipboard.writeText(text);
        alert("ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    };

    document.getElementById("retakeBtn").onclick = () => openCamera();

    document.getElementById("openBtn").onclick = () => {
        const fileInput = document.getElementById("fileInput");
        fileInput.accept = "image/*";
        fileInput.click();

        fileInput.onchange = () => {
            const file = fileInput.files[0];
            if (!file) return;

            const imgURL = URL.createObjectURL(file);
            document.getElementById("previewImg").src = imgURL;

            readImageGPS(file);
        };
    };
</script>

</body>
</html>
